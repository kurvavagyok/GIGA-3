
<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Szimulációs Eredmények Elemzése - Deep Discovery AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-black text-white min-h-screen">
    <div class="container mx-auto p-6">
        <h1 class="text-3xl font-bold mb-8 text-center bg-gradient-to-r from-green-400 to-blue-500 bg-clip-text text-transparent">
            <i class="fas fa-chart-line mr-3"></i>Szimulációs Eredmények Elemzése
        </h1>

        <!-- Eredmény feltöltés -->
        <div class="bg-gray-900 rounded-xl p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">
                <i class="fas fa-upload text-blue-400 mr-2"></i>Szimulációs Adatok Feltöltése
            </h2>
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium mb-2">Szimuláció típusa</label>
                    <select id="simulationType" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3">
                        <option value="molecular_dynamics">Molekuláris Dinamika</option>
                        <option value="quantum_chemistry">Kvantumkémia</option>
                        <option value="materials_science">Anyagtudomány</option>
                        <option value="drug_discovery">Gyógyszerkutatás</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Eredmény formátum</label>
                    <select id="resultFormat" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3">
                        <option value="json">JSON</option>
                        <option value="csv">CSV</option>
                        <option value="xyz">XYZ koordináták</option>
                        <option value="pdb">PDB struktúra</option>
                    </select>
                </div>
            </div>
            <div class="mt-4">
                <label class="block text-sm font-medium mb-2">Szimulációs eredmények</label>
                <textarea id="simulationResults" rows="6" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3" 
                    placeholder="Illeszd be a szimulációs eredményeket..."></textarea>
            </div>
            <button id="analyzeBtn" class="mt-4 bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 px-6 py-3 rounded-lg font-medium transition-all">
                <i class="fas fa-microscope mr-2"></i>Eredmények Elemzése
            </button>
        </div>

        <!-- Elemzési eredmények -->
        <div id="analysisResults" class="hidden">
            <!-- Statisztikai összefoglaló -->
            <div class="bg-gray-900 rounded-xl p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4">
                    <i class="fas fa-chart-bar text-green-400 mr-2"></i>Statisztikai Összefoglaló
                </h3>
                <div class="grid md:grid-cols-4 gap-4" id="statsGrid">
                    <!-- Dinamikusan generált statisztikák -->
                </div>
            </div>

            <!-- Vizualizációk -->
            <div class="grid lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-gray-900 rounded-xl p-6">
                    <h3 class="text-lg font-semibold mb-4">
                        <i class="fas fa-line-chart text-blue-400 mr-2"></i>Trendanalízis
                    </h3>
                    <div id="trendPlot" class="w-full h-64"></div>
                </div>
                <div class="bg-gray-900 rounded-xl p-6">
                    <h3 class="text-lg font-semibold mb-4">
                        <i class="fas fa-pie-chart text-purple-400 mr-2"></i>Eloszlás
                    </h3>
                    <div id="distributionPlot" class="w-full h-64"></div>
                </div>
            </div>

            <!-- AI javaslatok -->
            <div class="bg-gray-900 rounded-xl p-6">
                <h3 class="text-lg font-semibold mb-4">
                    <i class="fas fa-robot text-yellow-400 mr-2"></i>AI Javaslatok a Következő Lépésekhez
                </h3>
                <div id="aiSuggestions" class="space-y-4">
                    <!-- AI generált javaslatok -->
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('analyzeBtn').addEventListener('click', async () => {
            const simulationType = document.getElementById('simulationType').value;
            const resultFormat = document.getElementById('resultFormat').value;
            const results = document.getElementById('simulationResults').value;

            if (!results.trim()) {
                alert('Kérlek add meg a szimulációs eredményeket!');
                return;
            }

            try {
                // AI elemzés kérése
                const response = await fetch('/api/deep_discovery/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: `Elemezd a következő ${simulationType} szimulációs eredményeket (${resultFormat} formátum): ${results}. Add meg: 1) Főbb statisztikákat, 2) Trendeket és mintázatokat, 3) Gyakorlati alkalmazási javaslatokat, 4) Következő kutatási lépéseket.`,
                        user_id: 'simulation_analyzer_' + Date.now()
                    })
                });

                const analysisData = await response.json();
                
                // Eredmények megjelenítése
                document.getElementById('analysisResults').classList.remove('hidden');
                
                // Statisztikák generálása
                generateStats(results, simulationType);
                
                // Grafikonok készítése
                createTrendPlot(results);
                createDistributionPlot(results);
                
                // AI javaslatok megjelenítése
                displayAISuggestions(analysisData.response);

            } catch (error) {
                console.error('Elemzési hiba:', error);
                alert('Hiba történt az elemzés során: ' + error.message);
            }
        });

        function generateStats(results, type) {
            // Egyszerű statisztikai számítások
            const lines = results.split('\n').filter(line => line.trim());
            const numbers = results.match(/[-+]?\d*\.?\d+/g)?.map(Number) || [];
            
            const stats = [
                { label: 'Adatpontok', value: lines.length, icon: 'fas fa-database', color: 'text-blue-400' },
                { label: 'Numerikus értékek', value: numbers.length, icon: 'fas fa-calculator', color: 'text-green-400' },
                { label: 'Átlag', value: numbers.length ? (numbers.reduce((a,b) => a+b, 0) / numbers.length).toFixed(3) : 'N/A', icon: 'fas fa-chart-line', color: 'text-purple-400' },
                { label: 'Tartomány', value: numbers.length ? `${Math.min(...numbers).toFixed(2)} - ${Math.max(...numbers).toFixed(2)}` : 'N/A', icon: 'fas fa-arrows-alt-h', color: 'text-yellow-400' }
            ];

            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = stats.map(stat => `
                <div class="text-center p-4 bg-gray-800 rounded-lg">
                    <i class="${stat.icon} ${stat.color} text-2xl mb-2"></i>
                    <div class="text-2xl font-bold">${stat.value}</div>
                    <div class="text-sm text-gray-400">${stat.label}</div>
                </div>
            `).join('');
        }

        function createTrendPlot(results) {
            const numbers = results.match(/[-+]?\d*\.?\d+/g)?.map(Number) || [];
            
            if (numbers.length > 0) {
                const trace = {
                    x: Array.from({length: numbers.length}, (_, i) => i + 1),
                    y: numbers,
                    type: 'scatter',
                    mode: 'lines+markers',
                    line: { color: '#10B981' },
                    marker: { color: '#3B82F6' }
                };

                const layout = {
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    font: { color: 'white' },
                    xaxis: { gridcolor: '#374151' },
                    yaxis: { gridcolor: '#374151' }
                };

                Plotly.newPlot('trendPlot', [trace], layout, {responsive: true});
            }
        }

        function createDistributionPlot(results) {
            const numbers = results.match(/[-+]?\d*\.?\d+/g)?.map(Number) || [];
            
            if (numbers.length > 0) {
                const trace = {
                    x: numbers,
                    type: 'histogram',
                    marker: { color: '#8B5CF6' }
                };

                const layout = {
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    font: { color: 'white' },
                    xaxis: { gridcolor: '#374151' },
                    yaxis: { gridcolor: '#374151' }
                };

                Plotly.newPlot('distributionPlot', [trace], layout, {responsive: true});
            }
        }

        function displayAISuggestions(aiResponse) {
            const suggestions = document.getElementById('aiSuggestions');
            suggestions.innerHTML = `
                <div class="p-4 bg-gray-800 rounded-lg">
                    <div class="prose prose-invert max-w-none">
                        ${aiResponse.replace(/\n/g, '<br>')}
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
